<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>화장품 상세페이지</title>

<link rel="stylesheet" href="detailpage.css">
</head>
<body>
   <div id="header"></div>
   <!-- 공통 헤더(상단바) 삽입 -->

   <div class="container">
      <div class="left">
      
         <!-- 이미지 사이드 쇼 -->
<div class="slideshow-container">

  <!-- Full-width images with number and caption text -->
  <div class="mySlides fade">
    <img src="https://i.pinimg.com/564x/db/a1/f2/dba1f28adc32bc960e89ee4dd4ffa027.jpg" alt="Slide 1">
  </div>

  <div class="mySlides fade">
    <img src="https://i.pinimg.com/564x/d9/d3/82/d9d3829fc798b6107ca26649c3000b13.jpg" alt="Slide 2">
  </div>

  <div class="mySlides fade">
    <img src="https://i.pinimg.com/564x/17/71/74/177174a71afb907c30f5af5563b7375d.jpg" alt="Slide 3">
  </div>
</div>

      
        
      </div>
 
      
      <div class="right">
         <p class="brand-name">브랜드 이름</p>
         <p class="product-title">히알루론산 앰플 50ml</p>
         <div class="divider"></div>
         <p class="description">
            우수한 수분력, 다양한 피부 타입에 적합함, 쾌적한 향기가 피부를 수분감있고 부드럽게 가꾸어 줍니다. 친환경 비건제품으로 예민한 피부에 적합한 제품입니다.
         </p>
         <div class="divider"></div>
         <div class="product-info">
            <div class="product-quantity">
               <button onclick="decrease(this)">-</button>
               <span class="quantity-number" id="quantity">1</span>
               <button onclick="increase(this)">+</button>
            </div>
            <span class="product-price" data-price="40000">40,000원</span>
         </div>
         <div class="buttons">
            <button onclick="saveToLocalStorage(); cart();" class="add-to-cart">장바구니</button>
            <button onclick="saveToLocalStorage(); checkout();" class="checkout">바로구매</button>
            <button class= "wishlist-button"><img src="../../res/images/heart-icon.png" alt="wishlist" class="wishlist"></button>
         </div>
      </div>
   </div>
   
   
   <!-- 밑에 다른 이미지 -->
<div class="sideimg">
  <!-- Next and previous buttons -->
  <a class="prev" onclick="plusSlides(-1)"><img src="../../res/images/left-icon.png" alt="Previous" style="width:80%"></a>
  
  <div class="currentSlide-container">
  <span class="dot" onclick="currentSlide(1)"><img src="https://i.pinimg.com/564x/db/a1/f2/dba1f28adc32bc960e89ee4dd4ffa027.jpg" alt="currentSlide(1)" style="width: 25%"></span>
  <span class="dot" onclick="currentSlide(2)"><img src="https://i.pinimg.com/564x/d9/d3/82/d9d3829fc798b6107ca26649c3000b13.jpg" alt="currentSlide(2)" style="width: 25%"></span>
  <span class="dot" onclick="currentSlide(3)"><img src="https://i.pinimg.com/564x/17/71/74/177174a71afb907c30f5af5563b7375d.jpg" alt="currentSlide(3)" style="width: 25%"></span>
  </div>
  
  <a class="next" onclick="plusSlides(1)"><img src="../../res/images/right-icon.png" alt="Next" style="width:80%"></a>
</div>

   
   <!-- 상세페이지, 리뷰페이지 -->
   <div class="tab">
   <div class="tab1">
      <button id="detailTab" class="tablinks" onclick="openTab(event, 'Detail')">상세정보</button>
   	  <div id="dividerDetail" class="divider divider-detail"></div>
   </div>
   <div class="tab2">
   <button id="reviewTab" class="tablinks" onclick="openTab(event, 'Review')">리뷰</button>
   	  <div id="dividerReview" class="divider divider-review"></div>
   </div>
 	</div>
   
   <div id="Detail" class="tabcontent">
	   <img src="../../res/images/detailpage.png" alt="상세 이미지" class="detailpage" style= "width: 780px">
	   <a href="../detail/detailpage.html"></a> 
   </div>
   
   <div id="Review" class="tabcontent">
   <a href="../review/review.html"></a>
   </div>
   
   <!-- 업버튼 -->
        <div class="main-products">
            <button class="scroll-btn-up" onclick="scrollToTop()"></button>
        </div>
   
   

   <div id="footer"></div>
   <!-- 푸터를 삽입할 위치 -->

   <script>
       function loadHTML(file, elementId) {
            fetch(file)
                .then(response => response.text())
                .then(data => {
                    document.getElementById(elementId).innerHTML = data;
                })
                .catch(error => console.error(error));
        }
        document.addEventListener('DOMContentLoaded', () => {
            loadHTML('../header/header.html', 'header');
            loadHTML('../footer/footer.html', 'footer');
        });
        
        // 찜 추가
        const wishlistButton = document.querySelector('.wishlist-button');

        wishlistButton.addEventListener('click', function() {
        	const productDiv = this.closest('.product-info');
        	const productNameSpan = document.querySelector('.product-title');
        	
        	if (!productNameSpan) return;
        	const productName = productNameSpan.innerText.trim();
        	
            this.classList.toggle('active'); // active 클래스를 토글
        	
            // 추가 기능: 위시리스트에 아이템 추가/제거 로직 구현 가능
            if (this.classList.contains('active')) {
                console.log("아이템이 위시리스트에 추가되었습니다.");
                saveToWishlist(productName);
            } else {
                console.log("아이템이 위시리스트에서 제거되었습니다.");
                removeFromWishlist(productName);
            }
        });
        
        function saveToWishlist(productName) {
        	let wishlist = JSON.parse(localStorage.getItem('whislist')) || [];
        	if (!wishlist.includes(productName)) {
        		wishlist.push(productName);
        	}
        	localStorage.setItem('wishlist', JSON.stringify(wishlist));
        	console.log(`위시리스트에 저장된 아이템: ${wishlist.join(', ')}`);
        }
        
        function removeFromWishlist(productName) {
        	let wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
        	wishlist = wishlist.filter(item => item !== productName);
        	localStorage.setItem('wishlist', JSON.stringify(wishlist));
        	console.log(`위시리스트에서 제거된 아이템: ${productName}`);
        }
        
        /* 이미지 스크롤 */
        let slideIndex = 1;
        showSlides(slideIndex);

        // Next/previous controls
        function plusSlides(n) {
          showSlides(slideIndex += n);
        }

        // Thumbnail image controls
        function currentSlide(n) {
          showSlides(slideIndex = n);
        }

        function showSlides(n) {
          let i;
          let slides = document.getElementsByClassName("mySlides");
          let dots = document.getElementsByClassName("dot");
          /* let captionText = document.getElementById("caption"); */
          if (n > slides.length) {slideIndex = 1}
          if (n < 1) {slideIndex = slides.length}
          for (i = 0; i < slides.length; i++) {
            slides[i].style.display = "none";
          }
          for (i = 0; i < dots.length; i++) {
            dots[i].className = dots[i].className.replace(" active", "");
          }
          slides[slideIndex-1].style.display = "block";
          dots[slideIndex-1].className += " active";
          captionText.innerHTML = dots[slideIndex-1].alt;
        }
        
        
        //클릭시 상세페이지, 리뷰로 이동
         	document.addEventListener("DOMContentLodaded", function() {
            document.getElementById("detailTab").click();            
            
            });
        
        function openTab(evt, tabName) {
        	var i, tabcontent, tablinks;
        	
        	tabcontent = document.getElementsByClassName("tabcontent");
        	for (i=0; i < tabcontent.length; i++) {
        		tabcontent[i].style.display = "none";
        	}
        	
        	tabcontent = document.getElementsByClassName("tablinks");
        	for (i=0; i < tablinks.length; i++) {
        		tablinks[i].classList.remove("active");
        	}
        	
        	document.getElementById(tabName).style.display = "block";
        	evt.currentTarget.classList.add("active");
        }	        	
            
            document.getElementById('reviewTab').addEventListener('click', function() {
                window.location.href = '../review/review.html';
            });
        
        
        
     // 동적으로 이미지 크기 맞추기
        const leftImage = document.querySelector('.slideshow-container');

        function adjustImageSize() {
          const containerHeight = document.querySelector('.left').offsetHeight;
          leftImage.style.height = `${containerHeight}px`;
        }

        window.addEventListener('resize', adjustImageSize);
        adjustImageSize(); // 초기 실행
        
        
        
        
                 
        /* 수량 조절 */
        function increase(button) {
            const productDiv = button.closest('.product-info'); // 부모 요소 찾기
            if (!productDiv) return; // productDiv가 null인 경우 함수 종료

            const quantitySpan = productDiv.querySelector('.quantity-number');
            const priceSpan = productDiv.querySelector('.product-price');

            if (!quantitySpan || !priceSpan) return; // 요소가 없으면 함수 종료

            let quantity = parseInt(quantitySpan.innerText);
            quantity += 1;
            quantitySpan.innerText = quantity;

            /* 가격 업데이트 */ 
            const pricePerUnit = parseFloat(priceSpan.getAttribute('data-price'));
            const totalPrice = (pricePerUnit * quantity).toLocaleString() + '원';
            priceSpan.innerText = totalPrice; // 가격 업데이트

            // 해당 정보 로컬 스토리지에 저장
            saveToLocalStorage(productDiv);
            console.log("수량 증가");
        }
     
        
        // 마이페이지에서 위시리스트 불러오기
       /*  function loadWishlist() {
        	const wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
        	const wishlistContainer = document.querySelector('.wishlist-container');
        	
        	wishlist.forEach(item => {
        		const itemElement = document.createElement('div');
        		itemElement.textContent = item;
        		wishlistContainer.appendChild(itemElement);
        	});
        } // 마이페이지 로드 시 호출
        document.addEventListener('DOMContentLoaded', loadWishlist); */
        

        

        function decrease(button) {
            const productDiv = button.closest('.product-info'); // 부모 요소 찾기
            if (!productDiv) return; // productDiv가 null인 경우 함수 종료

            const quantitySpan = productDiv.querySelector('.quantity-number');
            const priceSpan = productDiv.querySelector('.product-price');

            if (!quantitySpan || !priceSpan) return; // 요소가 없으면 함수 종료

            let quantity = parseInt(quantitySpan.innerText);
            quantity -= 1;
            if (quantity < 1) {
                quantity = 1;
            }
            quantitySpan.innerText = quantity;

            /* 가격 업데이트 */ 
            const pricePerUnit = parseFloat(priceSpan.getAttribute('data-price'));
            const totalPrice = (pricePerUnit * quantity).toLocaleString() + '원';
            priceSpan.innerText = totalPrice; // 가격 업데이트

            // 해당 정보 로컬 스토리지에 저장
            saveToLocalStorage(productDiv);
        }

        // 로컬 스토리지에 저장하는 함수
        function saveToLocalStorage(productDiv) {
            const quantitySpan = document.querySelector('.quantity-number');
            const priceSpan = document.querySelector('.product-price');
            const productNameSpan = document.querySelector('.product-title');

            if (!quantitySpan || !priceSpan || !productNameSpan) return; // 요소가 없으면 함수 종료

            const productName = productNameSpan.innerText.trim(); // 상품명
            const quantity = parseInt(quantitySpan.innerText); // 수량
            const price = priceSpan.getAttribute('data-price'); // 가격 (숫자형)

            const productInfo = {
                name: productName,
                quantity: quantity,
                price: price
            };

            // 로컬 스토리지에 저장
            localStorage.setItem(productName, JSON.stringify(productInfo));

            console.log(`저장된 상품: ${productName}, 수량: ${quantity}, 가격: ${price}`);
        }

        // 결제 페이지로 이동 시 호출되는 함수
        function checkout() {
            const cartItems = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const item = JSON.parse(localStorage.getItem(key));
                cartItems.push(item);
            }

            /* document.getElementById('add-to-cart').addEventListener('click', function() {
                window.location.href = '../payment/payment.html'; */
             sessionStorage.setItem('checkout', JSON.stringify(checkout));
            window.location.href = '../payment/payment.html'; // 결제 페이지로 이동 
        }
            
            
        function cart() {
            const cartItems = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const item = JSON.parse(localStorage.getItem(key));
                cartItems.push(item);
            }
        
        sessionStorage.setItem('add-to-cart', JSON.stringify(cart));
        window.location.href = '../basket/basket.html'; // 장바구니 페이지로 이동 
    }
        
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: "smooth",
            });
        }
        
        
    </script>
</body>
</html>
